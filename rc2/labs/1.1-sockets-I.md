# Laborat√≥rio 1.1: Comunica√ß√£o com Sockets e Estados de Sockets

## Objetivos

* Compreender o conceito de sockets como primitiva de comunica√ß√£o na rede
* Compreender o conceito de portas de comunica√ß√£o como identificador de processos comunicantes
* Compreender o estado de conex√µes TCP e UDP

## Vis√£o Geral

Neste laborat√≥rio voc√™ ir√° inspecionar os estados de conex√µes TCP e UDP, assim como as suas trocas de pacotes, de maneira a compreender melhor os aspectos da abstra√ß√£o de comunica√ß√£o provida por sockets.

## Recursos

### Slides

* [Slides sobre sockets](slides/) usados em sala de aula

### Softwares

* M√°quina Virtual utilizada nos experimentos, inclui o sistema `mininet` (ver em [mininet.org](https://github.com/mininet/mininet/wiki/Mininet-VM-Images)).
  * Recomendo que seja utilizada a vers√£o baseada no Ubuntu 16.04 (nem anterior e nem superior), para evitar problemas em alguns laborat√≥rios.
* **Wireshark**: ver video de discuss√£o do funcionamento da ferramenta
* **`netstat`**: ferramenta para verifica√ß√£o das conex√µes TCP e UDP. Op√ß√µes no Linux

        -t : sockets TCP
        -u : sockets UDP
        -n : exibe o valor num√©rico das portas
        -l : sockets esperando conex√µes (ouvindo)
        -c : atualiza continuamente o estado dos sockets

  Para op√ß√µes no Windows utilize o par√¢metro `/?`.

* **`nc`** (`netcat`): ferramenta de prop√≥sito geral para cria√ß√£o de sockets UDP e TCP para comunica√ß√£o. Op√ß√µes utilizadas neste laborat√≥rio

        -t : sockets TCP
        -u : sockets UDP
        -n : valor num√©rico das portas
        -l : sockets esperando conex√µes (ouvindo)
        -c : atualiza continuamente o estado dos sockets 
        -k : mant√©m o servidor aceitando e respondendo requisi√ß√µes ap√≥s o t√©rmino da sess√£o com cliente (sess√µes s√£o sequenciais - uma ap√≥s o t√©rmino de outra)

  Exemplos de uso:
  
  | Cria√ß√£o de servidor    |
  |-------------|
  | `nc -l 8888`: cria um socket servidor TCP ouvindo na porta 8888
  | `nc -kl 8888`: mesmo que o anterior, mas se mant√©m ouvindo novas conex√µes ap√≥s o t√©rmino da primeira ser√° op√ß√£o preferida neste lab
  | `nc -ul 8888` (UDP): cria um socket servidor UDP ouvindo na porta 8888
  
    
  | Cria√ß√£o de um Cliente    |
  |--------------------------|
  | `nc 127.0.0.1 8888`: estabelece uma conex√£o TCP com o socket servidor no IP 127.0.0.1, ouvindo na porta 8888.
  | `nc -u 127.0.0.1 8888` (UDP): envia pacotes UDP por sockets cliente UDP para o servidor no IP 127.0.0.1 na porta 8888.

## Atividades

<!--Recomenda√ß√£o: 
Antes de realizar as atividades propriamente ditas, veja a correspond√™ncia entre as atividades indicadas nesta descri√ß√£o do laborat√≥rio e aquelas esperadas no relat√≥rio, para que voc√™ n√£o precise refazer desnecessariamente alguma tarefa.

Os itens marcados com o √≠cone üìî precisar√£o constar no relat√≥rio do laborat√≥rio.-->

**Recomenda√ß√£o**

* Acesse o modelo de relat√≥irio na tarefa Github Classroom para se certificar de todas as tarefas que devem ser realizadas, bem como dos dados que voc√™ precisa coletar e colocar no relat√≥rio.



1. Observe os sockets abertos na pr√≥pria esta√ß√£o (servidores e clientes) utilizando o netstat, utilizando a op√ß√£o `-c` junto √†s demais op√ß√µes referentes ao tipo de socket pretendido.
2. Estabele√ßa uma conex√£o TCP com um servidor e fech√°-la, observando a mudan√ßa nos estados na conex√£o via netstat. **Sugest√£o**: utilize o `wget` para realizar uma requisi√ß√£o HTTP simples com um servidor.

   **As atividades abaixo devem ser realizadas no mininet, para que cliente e servidor possuam IPs diferentes.**

3. üìî Utilizando um cen√°rio mininet com um m√≠nimo de duas esta√ß√µes, abra um terminal (`xterm`) para cada esta√ß√£o. Sempre que voc√™ precisar executar mais de um comando simult√¢neo em uma esta√ß√£o, voc√™ dever√° abrir um novo terminal. **Identifique** os endere√ßos IPs das esta√ß√µes. 

4. Nesses terminais, utilizando o `netcat` (`nc`, n√£o confundir com `netstat`), estabelecer um socket servidor e iniciar uma conex√£o TCP com esse servidor (que deve ser iniciado com a op√ß√£o **`-k`** do **`netcat`**). Realizar uma troca curta de mensagens.
   1. üìî Indique os pares de portas utilizados em cada conex√£o TCP no servidor, utilizando o padr√£o do seguinte exemplo para cada sess√£o encontrada (identificada pelo n√∫mero):
   
        `sessao 1: 192.168.1.1:8888 - 192.168.1.99:1000`
   
   2. üìî Registre os comandos utilizados para obter tais informa√ß√µes das conex√µes.
   3. Acompanhe as mudan√ßas nos estados da conex√£o TCP, durante o estabelecimento de conex√£o e at√© o fim da conex√£o.
   4. üìî Indique os estados das conex√µes na ordem em que eles ocorrem e seguindo o nome especificado na pr√≥pria especifica√ß√£o TCP (tal como aparece no **`netstat`**). A sua resposta deve ter um estado por linha.
      * Se necess√°rio, repita o experimento v√°rias vezes at√© conseguir reportar todos os estados.
   5. üìî Inspecione os pacotes TCP trocados durante uma conex√£o usando **wireshark** (ou **tshark**), referentes ao in√≠cio e fechamento de sess√£o e troca de mensagens. Copie os pacotes trocados, usando a funcionalidade **Copy as CSV** (ou direcionando a sa√≠da do **tshark**).
   6. üìî Antes de finalizar uma conex√£o no **`netcat`**, procure iniciar outra conex√£o com o servidor e veja os pacotes que chegam no servidor e como ele os responde. Compare com o caso da conex√£o anterior.
   7. Estabele√ßa duas conex√µes TCP com um mesmo servidor e realize trocas curtas de mensagens.
   8. üìî Inspecionar os pacotes trocados, percebendo a diferen√ßa entre as duas conex√µes nos pacotes TCP.

5. üìî Refa√ßa os experimentos de (4.1) a (4.8), para sockets UDP.

### Quest√µes para Refletir e Fixar

Essas quest√µes tamb√©m devem ser respondidas no relat√≥rio. Volte √†s v√≠deo-aulas ou slides, se necess√°rio.

1. Por que o TCP estabelece precisamente diversos estados em uma conex√£o, enquanto que isso n√£o ocorre com o UDP?
2. Quais s√£o os estados de uma conex√£o TCP e qual √© o significado de cada uma delas?
3. Se h√° mais de uma conex√£o TCP estabelecida para um mesmo servidor, de que maneira o TCP diferencia uma conex√£o de outra?


## Relat√≥rio

O relat√≥rio deste laborat√≥rio deve ser baseado no modelo indicado na respectiva tarefa Github Classroom. Consulte o ambiente de sala de aula utilizado.
