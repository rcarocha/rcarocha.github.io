<p><!DOCTYPE html>
<html>
<title>Redes de Computadores 2 - Prof. Ricardo da Rocha</title></p>

<p><xmp theme="simplex" style="display:none;"></p>

<h1>LaboratÃ³rio: ComunicaÃ§Ã£o com Sockets e Arquitetura do HTTP</h1>

<h1>Objetivos</h1>

<ul>
<li>ReforÃ§ar o conceito de sockets como primitiva de comunicaÃ§Ã£o na rede</li>
<li>Compreender o uso de sockets no funcionamento de um protocolo, utilizando como exemplo o HTTP</li>
<li>Compreender as primitivas de uso de sockets e o seu mapeamento no funcionamento de um protocolo e no estado de conexÃ£o TCP.</li>
</ul>

<h1>VisÃ£o Geral</h1>

<p>Neste laboratÃ³rio vocÃª irÃ¡ inspecionar o funcionamento de uma comunicaÃ§Ã£o HTTP, verificando tanto os bytes transmitidos por meio da conexÃ£o TCP como os diversos estados da conexÃ£o. </p>

<h1>Recursos</h1>

<h2>Slides</h2>

<ul>
<li><a href="SOCKETS.HTTP.I.pdf">Slides utilizados no laboratÃ³rio</a> pelo professor.</li>
</ul>

<h2>Softwares</h2>

<ul>
<li><p><strong><code>netstat</code></strong>: ferramenta para verificaÃ§Ã£o das conexÃµes TCP e UDP.
OpÃ§Ãµes no Linux</p>

<pre><code>-t : sockets TCP
-u : sockets UDP
-n : exibe o valor numÃ©rico das portas
-l : sockets esperando conexÃµes (ouvindo)
-c : atualiza continuamente o estado dos sockets
</code></pre>

<p><a href="http://pt.wikipedia.org/wiki/Netstat">OpÃ§Ãµes no Windows</a> (ou utilize a opÃ§Ã£o /?)</p></li>
<li><p><strong><code>nc</code></strong> (<code>netcat</code>): ferramenta de propÃ³sito gerar para criaÃ§Ã£o de sockets UDP e TCP para comunicaÃ§Ã£o.
OpÃ§Ãµes utilizadas neste laboratÃ³rio</p>

<pre><code>-t : sockets TCP
-u : sockets UDP
-n : valor numÃ©rico das portas
-l : sockets esperando conexÃµes (ouvindo)
-c : atualiza continuamente o estado dos sockets
</code></pre>

<p>Exemplos de uso: </p>

<ul>
<li>Servidor: <code>nc -l 8888</code>: cria um socket servidor TCP ouvindo na porta 8888</li>
<li>Servidor: <code>nc -kl 8888</code>: mesmo que o anterior, mas se mantÃ©m ouvindo novas conexÃµes apÃ³s o tÃ©rmino da primeira</li>
<li>Servidor: <code>nc -ul 8888</code>: cria um socket servidor UDP ouvindo na porta 8888</li>
<li>Cliente: <code>nc  127.0.0.1 8888</code>: estabelece uma conexÃ£o TCP com o socket servidor no IP <code>127.0.0.1</code>, ouvindo na porta <code>8888</code>.</li>
<li>Cliente: <code>nc -u 127.0.0.1 8888</code>: envia pacotes UDP por sockets cliente UDP para o servidor no IP <code>127.0.0.1</code> na porta <code>8888</code>.</li>
</ul></li>
</ul>

<h1>Atividades</h1>

<ol>
<li>Execute o <code>nc</code> como cliente e como servidor, se comunicando e verifique a mudanÃ§a dos estados na conexÃ£o TCP usando o <code>netstat</code>, com atenÃ§Ã£o particular a:
<ol>
<li>Socket em estado de "listening"</li>
<li>Sockets com conexÃ£o estabelecida</li>
<li>Sockets fechando a conexÃ£o</li>
</ol></li>
<li><p>ApÃ³s uma revisÃ£o sobre o funcionamento do HTTP, utilize novamente o <code>nc</code> para inspecionar as mensagens enviadas por clientes e servidores HTTP.</p>

<ol>
<li>Execute o <code>nc</code> como socket servidor e faÃ§a uma requisiÃ§Ã£o HTTP para ele com um browser. <strong>Anote</strong> toda requisiÃ§Ã£o HTTP recebida pelo <code>nc</code>.</li>
<li>Qual Ã© o valor do cabeÃ§alho <code>USER-AGENT</code> recebido?</li>
<li>Copie a requisiÃ§Ã£o do item anterior e faÃ§a uma requisiÃ§Ã£o ao servidor web da pÃ¡gina da disciplina (vocÃª terÃ¡ que modificar o cabeÃ§alho <code>LOCATION</code> para o endereÃ§o da pÃ¡gina <code>www.inf.ufg.br</code>). Copie a resposta HTTP recebida.</li>
<li>FaÃ§a sucessivas requisiÃ§Ãµes nesse mesmo endereÃ§o, usando o <strong>browser</strong> e depois <strong>usando <code>nc</code></strong>  para obter os seguintes recursos HTTP:
<ul>
<li><code>/~ricardo/rc2/labs/exemplos/1.html</code></li>
<li><code>/~ricardo/rc2/labs/exemplos/1.txt</code></li>
<li><code>/~ricardo/rc2/labs/exemplos/1.pdf</code></li>
<li><code>/~ricardo/rc2/labs/exemplos/1.png</code></li>
</ul></li>
<li><p>Obtenha o cabeÃ§alho HTTP de todas as <strong>respostas</strong>, que identificam o conteÃºdo retornado. <strong>AtenÃ§Ã£o:</strong> apenas o cabeÃ§alho da resposta. Indique as respostas no seguinte formato (para as quatro solicitaÃ§Ãµes):</p>

<pre><code>/~ricardo/rc2/labs/exemplos/1.html
&lt;coloque as linhas do cabeÃ§alho aqui&gt;
-----
/~ricardo/rc2/labs/exemplos/1.txt
&lt;coloque as linhas do cabeÃ§alho aqui&gt;
</code></pre></li>
<li><p>FaÃ§a a requisiÃ§Ã£o do primeiro recurso via um browser a servidor <code>nc</code>, de maneira que o <code>nc</code> responda com o cabeÃ§alho de uma das outras respostas. Observe o comportamento do browser.</p></li>
</ol></li>
<li><p>Utilize o "Developer Tools"->"Network" (Firefox ou Chrome)  para reinspecionar as interaÃ§Ãµes novamente, mas agora usando o prÃ³prio browser para se comunicar com o servidor. Mantenha particular atenÃ§Ã£o em:</p>

<ul>
<li>As diversas interaÃ§Ãµes na rede necessÃ¡rias para o carregamento de uma pÃ¡gina, incluindo a resoluÃ§Ã£o de DNS.</li>
<li>Os diversos servidores acessados durante uma interaÃ§Ã£o.</li>
<li>Os tempos envolvidos nas requisiÃ§Ãµes e respostas.</li>
<li>Quanto um conteÃºdo estÃ¡ no cache do browser e quando nÃ£o estÃ¡ (assim como a requisiÃ§Ã£o e resposta HTTP que levaram a este comportamento).</li>
</ul></li>
<li>(<em>deverÃ¡ ser realizado com o Firefox</em>) Verifique o efeito do envio simultÃ¢neo de requisiÃ§Ãµes HTTP no desempenho da comunicaÃ§Ã£o, seguindo as seguintes etapas:
<ol>
<li>Carregue uma pÃ¡gina em particular (preferencialmente que gere diversas requisiÃ§Ãµes HTTP) e estime (utilizando o "Developer Tools") o tempo de carga total.</li>
<li>Apague o cache do browser.</li>
<li>Acesse as configuraÃ§Ãµes de baixo nÃ­vel do Firefox digitando na barra de endereÃ§os <code>about:config</code>.</li>
<li>Modifique as propriedades <strong><code>network.http.max-connections</code></strong> para <code>1</code>.</li>
<li>Repita o item (1).</li>
<li><strong>ATENÃÃO:</strong> volte a configuraÃ§Ã£o do Firefox para o valor original!</li>
</ol></li>
</ol>

<!--
RETIRADO DO LABORATORIO ANTERIOR
Siga as sugestÃµes do professor sobre os exemplos a serem utilizados. 
   * Inspecione os cabeÃ§alhos HTTP tanto de cliente como de servidor e procure compreender o significado deles.
      + Procure gerar tipos de respostas (cÃ³digo) diferentes do servidor
   * Simule algumas interaÃ§Ãµes HTTP do `nc` para o um servidor (exemplo: `www.google.com`), que ocorrem durante uma interaÃ§Ã£o entre browser e servidor (nÃ£o meramente uma requisiÃ§Ã£o HTTP).
   * Modifique um dos campos o cabeÃ§alho HTTP de maneira a forÃ§ar uma mudanÃ§a na resposta (o professor darÃ¡ exemplos simples durante a aula. Um deles pode ser com a modificaÃ§Ã£o do `user-agent` do cliente.
      + **Firefox no Android**: `Mozilla/5.0 (Android 5.1; Mobile; rv:50.0) Gecko/50.0 Firefox/50.0`
      + **Chrome no Android**: `Mozilla/5.0 (Linux; Android 5.1; XT1033 Build/LPBS23.13-56-2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.91 Mobile Safari/537.36`.
-->

<h1>RelatÃ³rio</h1>

<p>A entrega do relatÃ³rio deve ser pelo github classroom, com o qual vocÃªs terÃ£o uma Ã¡rea indicada a partir de email enviado para vocÃªs. Esse relatÃ³rio deve ser entregue em atÃ© 5 dias.</p>

<p>Todos os arquivos colocados no githuv devem estar codificados em <code>UTF-8</code> e devem ser arquivos de texto, seguindo a seguinte estrutura</p>

<pre><code>    README.md       - deve conter uma linha com o seu nome
    Lab2.2.2.1.txt    - resposta do item (2.1), com o dado indicado (obtido da mensagem HTTP) sem qualquer modificaÃ§Ã£o
    Lab2.2.2.2.txt    - resposta do item (2.2) 
    Lab2.2.2.3.txt    - resposta do item (2.3)
    Lab2.2.2.5.txt    - resposta do item (2.5)
</code></pre>

<!--
# RelatÃ³rio

No seu relatÃ³rio, vocÃª deverÃ¡ responder Ã s seguintes questÃµes:

1. Explique o significado dos estados de uma conexÃ£o TCP, e em quais condiÃ§Ãµes a conexÃ£o fica em cada estado.
2. Como um servidor sabe - considerando apenas o cabeÃ§alho da requisiÃ§Ã£o - as seguintes informaÃ§Ãµes do cliente (dÃª exemplos):
   1. O sistema operacional e/ou browser do usuÃ¡rio
   1. O tamanho da tela do dispositivo
   3. A localizaÃ§Ã£o do usuÃ¡rio
   4. A lÃ­ngua falada pelo usuÃ¡rio
3. DÃª dois exemplos de mudanÃ§as no cabeÃ§alho de uma requisiÃ§Ã£o HTTP que provocou mudanÃ§a na resposta (conteÃºdo) HTTP do servidor. SugestÃ£o: use `accept-language` para uma delas. Para cada exemplo, informe:
   * EndereÃ§o do servidor
   * RequisiÃ§Ãµes HTTP realizadas
   * Respostas HTTP diferentes obtidas (mostre sÃ³ as diferenÃ§as e de maneira resumida, se necessÃ¡rio).

O link para submissÃ£o do relatÃ³rio serÃ¡ indicado em tempo hÃ¡bil. Procure realizar as atividades antes - guardando em arquivo - para depois submeter tudo de uma vez.
-->

<!--
usar strace para log de chamadas de sistema

strace -o arquivo.log 



inspecionar diferentes tipos de respostas HTTP

user-agent 

Firefox no Android: Mozilla/5.0 (Android 5.1; Mobile; rv:50.0) Gecko/50.0 Firefox/50.0

Chrome no Android: Mozilla/5.0 (Linux; Android 5.1; XT1033 Build/LPBS23.13-56-2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.91 Mobile Safari/537.36

accept-encoding no G1
-->

<p></xmp></p>

<script src="https://strapdownjs.com/v/0.2/strapdown.js"></script>

<p></html></p>
